<!DOCTYPE html>
<html lang="en">

<head>
  <title>Rodger Hammerstien Character Sheet</title>
  <script defer src="alpine.js"></script>
  <link rel="stylesheet" href="/styles/global.css" />
</head>

<body>
  <main x-data>
    <h1>
      <span x-text="$store.d.name"></span>
      <br />
      <span class="h2small" x-html="'Level ' + $store.d.level"></span>
    </h1>

    <div class="cards1">
      <table>
        <tbody>
          <tr>
            <td>Health:</td>
            <td x-html="$store.d.health.current + `/` + $store.d.health.max"></td>
          </tr>
          <tr>
            <td>Regen:</td>
            <td x-text="$store.d.health.regen"></td>
          </tr>
        </tbody>
      </table>

      <table>
        <tbody>
          <tr>
            <td>Shields:</td>
            <td x-html="$store.d.shields.current + `/` + $store.d.shields.max"></td>
          </tr>
          <tr>
            <td>Regen:</td>
            <td x-html="$store.d.shields.regen"></td>
          </tr>
        </tbody>
      </table>

      <table>
        <tbody>
          <tr>
            <td>Movement:</td>
            <td x-text="$store.d.movement"></td>
          </tr>
          <tr>
            <td>Gold:</td>
            <td x-text="$store.d.gold"></td>
          </tr>
        </tbody>
      </table>

      <table>
        <tbody>
          <tr>
            <td>BA Rank:</td>
            <td x-text="$store.d.ba_rank"></td>
          </tr>
          <tr>
            <td>BA Tokens:</td>
            <td x-text="$store.d.ba_tokens"></td>
          </tr>
        </tbody>
      </table>

    </div>


    <h2>Initiative<br>
      <div class="h2small">Natural: <span x-text="$store.d.rolls.initiative_natural">0</span> - Total: <span
          x-text="$store.d.rolls.initiative_total">0</span></div>
    </h2>
    <div class="cards1">
      <table>
        <tbody>
          <tr>
            <td>Speed Mod:</td>
            <td x-html="`+` + $store.d.stat_value('Speed')"></td>
          </tr>
          <tr>
            <td>Misc Mod:</td>
            <td x-html="`+` + $store.d.stat_value('Initiative_Mod')"></td>
          </tr>
        </tbody>
      </table>
      <table>
        <tbody>
          <tr>
            <td>BA Rank:</td>
            <td x-text="$store.d.ba_rank"></td>
          </tr>
          <tr>
            <td>1d20</td>
            <td><button class="roller" @click="$store.d.roll_initiative()">Roll</button></td>
          </tr>
        </tbody>
      </table>
    </div>

    <h2>Skill Checks<br>
      <div class="h2small">Natural: <span x-text="$store.d.rolls.checks_natural">0</span>
        - Total: <span x-text="$store.d.rolls.checks_total">0</span>
      </div>
    </h2>

    <div class="cards1">
      <table>
        <tbody>
          <tr>
            <td><button class="roller" @click="$store.d.skill_check($store.d.check_insight())">Insight:</button></td>
            <td x-text="$store.d.check_insight()"></td>
          </tr>
          <tr>
            <td><button class="roller" @click="$store.d.skill_check($store.d.check_interact())">Interact:</button></td>
            <td x-text="$store.d.check_interact()"></td>
          </tr>
        </tbody>
      </table>
      <table>
        <tbody>
          <tr>
            <td><button class="roller" @click="$store.d.skill_check($store.d.check_search())">Search:</button></td>
            <td x-text="$store.d.check_search()"></td>
          </tr>
          <tr>
            <td><button class="roller" @click="$store.d.skill_check($store.d.check_search_loot())">Loot Search:</button>
            </td>
            <td x-text="$store.d.check_search_loot()"></td>
          </tr>
        </tbody>
      </table>
      <table>
        <tbody>
          <tr>
            <td><button class="roller" @click="$store.d.skill_check($store.d.check_sneak())">Sneak:</button></td>
            <td x-text="$store.d.check_sneak()"></td>
          </tr>
          <tr>
            <td><button class="roller" @click="$store.d.skill_check($store.d.check_sneak_guild())">Guild Sneak:</button>
            </td>
            <td x-text="$store.d.check_sneak_guild()"></td>
          </tr>
        </tbody>
      </table>
      <table>
        <tbody>
          <tr>
            <td><button class="roller" @click="$store.d.skill_check($store.d.check_talk())">Talk:</button></td>
            <td x-text="$store.d.check_talk()"></td>
          </tr>
          <tr>
            <td><button class="roller" @click="$store.d.skill_check($store.d.check_traverse())">Traverse:</button></td>
            <td x-text="$store.d.check_traverse()"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!--

    <h2>General Rolls<br>
      <div class="h2small">
        Natural:
        <span id="General_Roll">0</span>
      </div>
    </h2>

    <div class="cards1">
      <table>
        <tbody>
          <tr>
            <td><button class="general_roller" data-type="4">1d4</button></td>
            <td id="Roll_1d4"></td>
          </tr>
        </tbody>
      </table>

      <table>
        <tbody>
          <tr>
            <td><button class="general_roller" data-type="6">1d6</button></td>
            <td id="Roll_1d6"></td>
          </tr>
        </tbody>
      </table>

      <table>
        <tbody>
          <tr>
            <td><button class="general_roller" data-type="8">1d8</button></td>
            <td id="Roll_1d8"></td>
          </tr>
        </tbody>
      </table>

      <table>
        <tbody>
          <tr>
            <td><button class="general_roller" data-type="10">1d10</button></td>
            <td id="Roll_1d10"></td>
          </tr>
        </tbody>
      </table>

      <table>
        <tbody>
          <tr>
            <td><button class="general_roller" data-type="12">1d12</button></td>
            <td id="Roll_1d12"></td>
          </tr>
        </tbody>
      </table>

      <table>
        <tbody>
          <tr>
            <td><button class="general_roller" data-type="20">1d20</button></td>
            <td id="Roll_1d20"></td>
          </tr>
        </tbody>
      </table>

    </div>

    <h2>Range Attack<br>
      <div class="h2small">
        Damage:
        <span id="Total_Damage">0</span>
      </div>
    </h2>

    <div class="cards2">
      <table>
        <tbody>
          <tr>
            <td>Natural:</td>
            <td id="Roll_Natural">0</td>
          </tr>
          <tr>
            <td>Modifier:</td>
            <td id="Accuracy_Adjustment" class="plus">0</td>
          </tr>
          <tr>
            <td>Calculated:</td>
            <td id="Roll_Total">0</td>
          </tr>
        </tbody>
      </table>
      <table>
        <tbody>
          <tr>
            <td>Hits:</td>
            <td id="Hits">0</td>
          </tr>
          <tr>
            <td>Roll:</td>
            <td><strong id="Natural_Hit_Rolls">0</strong></td>
          </tr>
        </tbody>
      </table>
      <table>
        <tbody>
          <tr>
            <td>Crits:</td>
            <td id="Crits">0</td>
          </tr>
          <tr>
            <td>Roll:</td>
            <td><strong id="Natural_Crit_Rolls">0</strong></td>
          </tr>
        </tbody>
      </table>
      <table>
        <tbody>
          <tr>
            <td>FavGun DMG:</td>
            <td><strong id="Favored_Gun_Damage_Mod" class="plus">0</strong></td>
          </tr>
          <tr>
            <td>Bonuses:</td>
            <td><strong id="Damage_Bonuses" class="plus">0</strong></td>
          </tr>
        </tbody>
      </table>
    </div>

    <h2>Guns!</h2>
    <div class="cards3">
      <table class="gun_details">
        <tbody>
          <tr>
            <td><strong>Crappy Sniper</strong></td>
            <td>
              <button class="accuracy_roller" data-gun="0">Roll</button>
            </td>
          </tr>
          <tr>
            <td colspan="2">From Black Powder</td>
          </tr>
          <tr>
            <td>Type:</td>
            <td id="Gun_Type_gun0">Sniper</td>
          </tr>
          <tr>
            <td>Favored:</td>
            <td id="Is_Favored_Gun_Type__gun0">yes</td>
          </tr>
          <tr>
            <td>Range: </td>
            <td>8</td>
          </tr>
          <tr>
            <td>Damage Die:</td>
            <td class="DamageDie__gun0">10</td>
          </tr>
          <tr>
            <td>Gun_Accuracy_Mod:</td>
            <td class="Gun_Accuracy_Mod__gun0 plus">2</td>
          </tr>
          <tr>
            <td>Gun_Crit_Damage_Mod:</td>
            <td class="Gun_Crit_Damage_Mod__gun0 plus">2</td>
          </tr>
          <tr>
            <td>Range 3 = ACC +3</td>
            <td><input type="checkbox" class="Gun_Accuracy_Mod__gun0_toggle" data-value="3" checked="">
            </td>
          </tr>
          <tr>
            <td class="hits_count_gun0" data-min="8" data-value="1">Add
              1 hit at:
            </td>
            <td>
              8
            </td>
          </tr>
          <tr>
            <td class="crits_count_gun0" data-min="16" data-value="1">
              Add 1 crit at:
            </td>
            <td>
              16
            </td>
          </tr>

        </tbody>
      </table>

      <table class="gun_details">
        <tbody>
          <tr>
            <td><strong>Synergy</strong></td>
            <td>
              <button class="accuracy_roller" data-gun="1">Roll</button>
            </td>
          </tr>
          <tr>
            <td colspan="2">From Alas!</td>
          </tr>
          <tr>
            <td>Type:</td>
            <td id="Gun_Type_gun1">Pistol</td>
          </tr>
          <tr>
            <td>Favored:</td>
            <td id="Is_Favored_Gun_Type__gun1">no</td>
          </tr>
          <tr>
            <td>Range: </td>
            <td>5</td>
          </tr>
          <tr>
            <td>Damage Die:</td>
            <td class="DamageDie__gun1">4</td>
          </tr>
          <tr>
            <td>Damage Die:</td>
            <td class="DamageDie__gun1">4</td>
          </tr>
          <tr>
            <td>Gun_Damage_Mod:</td>
            <td class="Gun_Damage_Mod__gun1 plus">1</td>
          </tr>
          <tr>
            <td class="hits_count_gun1" data-min="2" data-value="1">Add 1 hit at:</td>
            <td>2</td>
          </tr>
          <tr>
            <td class="hits_count_gun1" data-min="8" data-value="1">Add 1 hit at:</td>
            <td>8</td>
          </tr>
          <tr>
            <td class="hits_count_gun1" data-min="16" data-value="1">Add 1 hit at:</td>
            <td>16</td>
          </tr>
        </tbody>
      </table>

    </div>


    <h2>Melee Attack
      <div class="h2small">
        Damage:
        <span id="Melee_Damage">0</span>
      </div>
    </h2>

    <div class="cards1">
      <table>
        <tbody>
          <tr>
            <td>1d4</td>
            <td><button class="melee_roller" data-value="4">Roll</button></td>
          </tr>
          <tr>
            <td>Natural:</td>
            <td id="Melee_Natural">0</td>
          </tr>
          <tr>
            <td>
              Mod:</td>
            <td id="Melee_Mod" class="plus">1</td>
          </tr>
        </tbody>
      </table>
    </div>

-->


    <h2>Base Stats</h2>
    <div class="cards1">
      <template x-for="stat_name in $store.d.stat_names">
        <table>
          <tr>
            <td x-text="stat_name"></td>
            <td x-text="$store.d.stat_value(stat_name)"></td>
          </tr>
          <tr>
            <td>Mod</td>
            <td x-text="$store.d.stat_mod(stat_name)"></td>
          </tr>
        </table>
      </template>
    </div>

    <template x-for="stat_category in $store.d.stat_categories">
      <div>
        <h2 x-text="stat_category[0]"></h2>
        <div class="cards1">
          <template x-for="stat_name in $store.d.stat_names">
            <table>
              <tr>
                <td x-text="stat_name"></td>
                <td x-text="$store.d.stat_values[stat_name][stat_category[1]]"></td>
              </tr>
            </table>
          </template>
        </div>
      </div>
    </template>

  </main>
  <script>
    document.addEventListener('alpine:init', () => {
      Alpine.store('d', {

        ba_rank: 1,
        ba_tokens: 0,
        gold: 113,
        level: 1,
        movement: 3,
        name: "Rodger Hammerstein",

        health: {
          max: 14,
          current: 14,
          regen: 0
        },

        stat_values: {
          Accuracy: {
            archetype: 4,
            background: 1,
            class: 2,
            skill_points: 0,
          },
          Damage: {
            archetype: 1,
            class: 2,
            skill_points: 0,
          },
          Damage_Mod_Favored_Gun: {
            caliber_level_1: 1
          },
          Guild_Sneak_Mod: {
            looter_trait: 5
          },
          Insight_Mod: {
            background: -2,
          },
          Interact_Mod: {},
          Initiative_Mod: {},
          Loot_Search_Mod: {
            insider_trait: 5
          },
          Mastery: {
            archetype: 2,
            class: 1,
            skill_points: 0,
          },
          Search_Mod: {
            caliber_level_1: 1
          },
          Sneak_Mod: {},
          Speed: {
            archetype: 0,
            class: 0,
            skill_points: 0,
          },
          Talk_Mod: {},
          Traverse_Mod: {},
        },

        rolls: {
          checks_natural: 0,
          checks_total: 0,
          initiative_natural: 0,
          initiative_total: 0,
        },

        shields: {
          max: 20,
          current: 20,
          regen: 5,
          type: "Basic",
          info: "Just a regular old shield that saves your ass"
        },

        stat_categories: [
          ["Skill Points", "skill_points"],
          ["Archetype: Deadeye", "archetype"],
          ["Class: Hunter", "class"],
        ],
        stat_names: ['Accuracy', 'Damage', 'Mastery', 'Speed'],

        traits: [
          {name: "Insider", desc: "+5 Loot Search Checks"},
          {name: "Looter", desc: "+5 Guild Sneak Checks"},
        ],



        check_insight() {
          return this.stat_mod("Accuracy") + this.stat_value("Insight_Mod")
        },

        check_interact() {
          return this.stat_mod("Accuracy") + this.stat_value("Interact_Mod")
        },

        check_search() {
          return this.stat_mod("Mastery") + this.stat_value("Search_Mod")
        },

        check_search_loot() {
          return this.check_search() + this.stat_value("Loot_Search_Mod")
        },

        check_sneak() {
          return this.stat_mod("Mastery") + this.stat_value("Sneak_Mod")
        },

        check_sneak_guild() {
          return this.check_sneak() + this.stat_value("Guild_Sneak_Mod")
        },

        check_talk() {
          return this.stat_mod("Speed") + this.stat_value("Talk_Mod")
        },

        check_traverse() {
          return this.stat_mod("Speed") + this.stat_value("Traverse_Mod")
        },


        roll(sides) {
          // Includes parseInt so you don't have to do it elsewhere
          const roll_holder = new Uint32Array(1)
          crypto.getRandomValues(roll_holder)
          const raw_roll = roll_holder[0] / (0xffffffff + 1)
          return Math.floor(raw_roll * parseInt(sides, 10)) + 1
        },

        roll_initiative() {
          this.rolls.initiative_natural = this.roll(20)
          this.rolls.initiative_total =
            this.rolls.initiative_natural +
            this.ba_rank +
            this.stat_mod("Speed") +
            this.stat_value('Initiative_Mod')
        },

        skill_check(mod) {
          this.rolls.checks_natural = this.roll(20)
          this.rolls.checks_total = this.rolls.checks_natural + mod
        },

        stat_value(name) {
          return Object.entries(this.stat_values[name]).map((k) => {
            return k[1]
          }).reduce((accumulator, currentValue) => accumulator + currentValue, 0)
        },

        stat_mod(name) {
          return Math.floor(this.stat_value(name) / 2)
        },

      })
    })
  </script>
</body>

</html>
