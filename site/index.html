<!DOCTYPE html>
<html>

<head>
  <title>Rodger Roller</title>
  <style>
    body {
      background-color: black;
      color: #aaa;
    }

    .stat_row {
      display: flex;
    }
  </style>
  <script>
    const roll_dice = (sides) => {
      const roll_holder = new Uint32Array(1)
      crypto.getRandomValues(roll_holder)
      const raw_roll = roll_holder[0] / (0xffffffff + 1)
      const roll = Math.floor(raw_roll * sides) + 1
      return roll
    }

    const get_stat_total = (class_name) => {
      return Array.from(
        document.getElementsByClassName(class_name)
      ).map((element) => {
        if (element.value) {
          return parseInt(element.value, 10)
        }
        else {
          return 0
        }
      }).reduce((accumulator, currentValue) => accumulator + currentValue, 0)
    }


    const get_toggle_total = (class_name) => {
      return Array.from(
        document.getElementsByClassName(class_name)
      ).map((element) => {
        if (element.checked) {
          return parseInt(element.dataset.mod, 10)
        }
        else {
          return 0
        }
      }).reduce((accumulator, currentValue) => accumulator + currentValue, 0)
    }

    const base_stats = ["Accuracy", "Damage", "Mastery", "Speed"]

    const updateValues = () => {
      base_stats.forEach((stat) => {
        window[`${stat}_Base`].innerHTML = get_stat_total(stat)
        window[`${stat}_Mod`].innerHTML = Math.floor(get_stat_total(stat) / 2)
      })
    }

    const roll_accuracy = (event) => {
      const gun_accuracy_mod = get_stat_total(`Accuracy_gun${event.target.dataset.gun}`)
      const base_accuracy = get_stat_total('Accuracy')
      const toggled_accuracy = get_toggle_total(`Accuracy_gun${event.target.dataset.gun}_toggle`)
      const accuracy_adjustment = gun_accuracy_mod + base_accuracy + toggled_accuracy
      const roll = roll_dice(20)
      window['roll_natural'].innerHTML = roll
      window['roll_modifier'].innerHTML = accuracy_adjustment
      window['roll_total'].innerHTML = roll + accuracy_adjustment
    }

    const init = () => {
      Array.from(
        document.getElementsByClassName('accuracy_roller')
      ).forEach((element) => {
        element.addEventListener('click', roll_accuracy)
      })
      updateValues()
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</head>

<body>
  <h1>Rodger Roller</h1>
  <p>This is my custom character sheet and dice roller for my Bunkers And Badasses character. </p>

  <h2>Roll</h2>
  <div>Natural: <strong id="roll_natural"></strong></div>
  <div>Modifier: <strong id="roll_modifier"></strong></div>
  <div>Total: <strong id="roll_total"></strong></div>

  <hr />

  <h2>Guns!</h2>
  
  
  <div>Name: Crappy Sniper</div>
  <div>Range: 8</div>
  <div>Stats</div>
  
  <div>Accuracy <input type="text" class="Accuracy_gun1" value="2" size="2"
      disabled /></div>
  
  <div>Crit_Damage <input type="text" class="Crit_Damage_gun1" value="2" size="2"
      disabled /></div>
  

  <div>Toggles</div>
  
  Range >3 = Accuracy +3 <input type="checkbox" class="Accuracy_gun1_toggle" data-mod="3">
  
  <div><button class="accuracy_roller" data-gun="1">Roll Accuracy</button></div>
  

  <h2>Core</h2>
  <div>
    <div>Accuracy: <span id="Accuracy_Base"></span> Mod: <span id="Accuracy_Mod"></span></div>
    <div>Damage: <span id="Damage_Base"></span> Mod: <span id="Damage_Mod"></span></div>
    <div>Mastery: <span id="Mastery_Base"></span> Mod: <span id="Mastery_Mod"></span></div>
    <div>Speed: <span id="Speed_Base"></span> Mod: <span id="Speed_Mod"></span></div>
  </div>

  <h2>Archetype: Deadeye</h2>
  <div class="stat_row">
    
    <div>Accuracy: <input class="Accuracy" type="text" size="2" value="4" disabled /></div>
    
    <div>Damage: <input class="Damage" type="text" size="2" value="1" disabled /></div>
    
    <div>Mastery: <input class="Mastery" type="text" size="2" value="2" disabled /></div>
    
    <div>Speed: <input class="Speed" type="text" size="2" value="0" disabled /></div>
    
  </div>

  <h2>Class: Hunter</h2>
  <div class="stat_row">
    
    <div>Accuracy: <input class="Accuracy" type="text" size="2" value="2" disabled /></div>
    
    <div>Damage: <input class="Damage" type="text" size="2" value="1" disabled /></div>
    
    <div>Mastery: <input class="Mastery" type="text" size="2" value="1" disabled /></div>
    
    <div>Speed: <input class="Speed" type="text" size="2" value="0" disabled /></div>
    
  </div>

  <h2>Background: Prize Shot</h2>
  <div class="stat_row">
    
    <div>Accuracy: <input class="Accuracy" type="text" size="2" value="1" disabled />
    </div>
    
    <div>Insight_Checks: <input class="Insight_Checks" type="text" size="2" value="-2" disabled />
    </div>
    
  </div>

  <h2>Action Skill</h2>
  <div>TODO: Add tickmarks for single use in combat and number per day equaly to mastery mod</div>

  <h2>Favored Gun</h2>
  <div>Sniper Rifle</div>

  <h2>Skill Tree</h2>
  <div>TODO</div>

  <h2>Melee Die</h2>
  <div>1D4</div>

  <h2>Traits</h2>
  <div>Insider: +5 Guild Sneak Checks</div>
  <div>Looter: +5 Loot Search Checks</div>

</body>

</html>